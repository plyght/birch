import {
  createMetaLoader
} from "../chunk-4757L6ST.js";
import {
  createStandaloneConfigLoader,
  toWebpack
} from "../chunk-ETIN2W7C.js";
import {
  createCore
} from "../chunk-2AQRQXSO.js";

// src/webpack/meta.ts
var instance;
async function loader(source, callback) {
  const { isDev, outDir, configPath } = this.getOptions();
  this.cacheable(true);
  this.addDependency(configPath);
  if (!instance) {
    const core = createCore({
      environment: "webpack",
      outDir,
      configPath
    });
    instance = toWebpack(
      createMetaLoader(
        createStandaloneConfigLoader({
          core,
          buildConfig: false,
          mode: isDev ? "dev" : "production"
        }),
        {
          json: "json",
          yaml: "yaml"
        }
      )
    );
  }
  await instance.call(this, source, callback);
}
export {
  loader as default
};
