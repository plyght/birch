import {
  getNegotiator
} from "../chunk-YVVDKJ2H.js";
import "../chunk-U67V476Y.js";

// src/i18n/middleware.ts
import { match as matchLocale } from "@formatjs/intl-localematcher";
import { NextResponse } from "next/server";
var COOKIE = "FD_LOCALE";
function getLocale(request, locales, defaultLanguage) {
  const languages = getNegotiator(request).languages(locales);
  return matchLocale(languages, locales, defaultLanguage);
}
var defaultFormat = (locale, path) => {
  return `/${locale}${path}`;
};
function createI18nMiddleware({
  languages,
  defaultLanguage,
  format = defaultFormat,
  hideLocale = "never"
}) {
  function getLocaleUrl(request, locale) {
    const next = new URL(request.url);
    next.pathname = format(locale, forceSlashPrefix(request.nextUrl.pathname));
    return next;
  }
  return (request) => {
    const url = request.nextUrl;
    const pathLocale = languages.find(
      (locale) => url.pathname.startsWith(`/${locale}/`) || url.pathname === `/${locale}`
    );
    if (!pathLocale) {
      if (hideLocale === "default-locale") {
        return NextResponse.rewrite(getLocaleUrl(request, defaultLanguage));
      }
      const preferred = getLocale(request, languages, defaultLanguage);
      if (hideLocale === "always") {
        const locale = request.cookies.get(COOKIE)?.value ?? preferred;
        return NextResponse.rewrite(getLocaleUrl(request, locale));
      }
      return NextResponse.redirect(getLocaleUrl(request, preferred));
    }
    if (hideLocale === "always" || hideLocale === "default-locale" && pathLocale === defaultLanguage) {
      const res = NextResponse.redirect(
        new URL(
          forceSlashPrefix(url.pathname.slice(`/${pathLocale}`.length)),
          request.url
        )
      );
      res.cookies.set(COOKIE, pathLocale);
      return res;
    }
    return NextResponse.next();
  };
}
function forceSlashPrefix(v) {
  if (v.startsWith("/")) return v;
  return "/" + v;
}
export {
  createI18nMiddleware
};
